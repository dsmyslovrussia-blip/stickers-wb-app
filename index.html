<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∏–∫–µ—Ä—ã –í–ë –∏ –û–∑–æ–Ω</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            padding: 25px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 26px;
            font-weight: 800;
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 25px;
        }
        .status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 700;
            margin-top: 10px;
            background: rgba(255,255,255,0.15);
        }
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .mode-btn {
            padding: 18px;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            background: white;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s;
        }
        .mode-btn.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            color: white;
        }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-full { grid-column: span 2; }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 18px;
            border-radius: 16px;
            text-align: center;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 6px;
        }
        .stat-label {
            font-size: 13px;
            color: #666;
            font-weight: 600;
        }
        .logs-section {
            margin-top: 25px;
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .logs-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
            font-weight: 700;
        }
        .log-container {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 12px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        .log-entry:last-child { border-bottom: none; margin-bottom: 0; }
        .log-time { color: #6272a4; margin-right: 12px; }
        .log-info { color: #8be9fd; }
        .log-success { color: #50fa7b; font-weight: 600; }
        .log-error { color: #ff5555; font-weight: 600; }
        .log-warning { color: #f1fa8c; font-weight: 600; }
        .log-action { color: #bd93f9; font-weight: 600; }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .bottom-space { height: 30px; }
        .process-page, .settings-page, .waiting-page { display: none; }
        .process-page.active, .settings-page.active, .waiting-page.active { display: block; }
        .back-btn {
            background: none;
            border: none;
            color: #667eea;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 15px;
        }
        .waiting-page { text-align: center; padding: 40px 20px; }
        .waiting-icon { font-size: 60px; margin-bottom: 20px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="mainPage">
            <h1>üñ®Ô∏è –°—Ç–∏–∫–µ—Ä—ã –í–ë –∏ –û–∑–æ–Ω</h1>
            <p class="subtitle">–õ–æ–∫–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</p>
            
            <div class="status-card">
                <h2>–°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞</h2>
                <div id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="status-badge" id="statusBadge">
                    <span class="loading"></span>–ó–∞–≥—Ä—É–∑–∫–∞
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="ordersCount">0</div>
                    <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stickersCount">0</div>
                    <div class="stat-label">–°—Ç–∏–∫–µ—Ä–æ–≤</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 15px; color: #333;">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h3>
            <div class="mode-selector">
                <div class="mode-btn active" data-mode="test">üß™ –¢–µ—Å—Ç</div>
                <div class="mode-btn" data-mode="production">üöÄ –†–∞–±–æ—á–∏–π</div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" id="startBtn">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                <button class="btn btn-secondary" id="statusBtn">üìä –°—Ç–∞—Ç—É—Å</button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-warning" id="logsBtn">üìù –õ–æ–≥–∏</button>
                <button class="btn btn-secondary" id="settingsBtn">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
            
            <button class="btn btn-danger btn-full" id="cancelBtn" disabled>‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É</button>
            
            <div class="logs-section">
                <h3>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="log-container" id="logContainer">
                    <div class="log-entry">
                        <span class="log-time">[00:00:00]</span>
                        <span class="log-info">‚ÑπÔ∏è –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</span>
                    </div>
                </div>
            </div>
            
            <div class="bottom-space"></div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ -->
        <div id="processPage" class="process-page">
            <button class="back-btn" id="backToMain">‚Üê –ù–∞–∑–∞–¥</button>
            <h1>üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤</h1>
            <p class="subtitle">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
            
            <div class="status-card">
                <h2 id="processStatus">–ó–∞–ø—É—Å–∫...</h2>
                <div id="processSubStatus">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
                <div class="status-badge" id="processBadge">
                    <span class="loading"></span>–í –ø—Ä–æ—Ü–µ—Å—Å–µ
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="processedOrders">0</div>
                    <div class="stat-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ</div>
                </div>
            </div>
            
            <div class="logs-section">
                <h3>üìù –ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                <div class="log-container" id="processLogContainer">
                    <div class="log-entry">
                        <span class="log-time">[00:00:00]</span>
                        <span class="log-info">‚ÑπÔ∏è –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏...</span>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-danger btn-full" id="processCancelBtn">‚ùå –ü—Ä–µ—Ä–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É</button>
            <div class="bottom-space"></div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–∂–∏–¥–∞–Ω–∏—è -->
        <div id="waitingPage" class="waiting-page">
            <div class="waiting-icon">‚è≥</div>
            <h2>–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h2>
            <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–∞—à–µ–º –∑–∞–ø—Ä–æ—Å–µ</p>
            <p style="color: #999; margin-top: 20px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
            <div style="margin-top: 30px;">
                <span class="loading"></span>
                <span style="color: #666;">–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω...</span>
            </div>
        </div>
        
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settingsPage" class="settings-page">
            <button class="back-btn" id="backToMainFromSettings">‚Üê –ù–∞–∑–∞–¥</button>
            <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–º</p>
            
            <div style="background: #f8f9fa; border-radius: 16px; padding: 20px; margin-bottom: 15px;">
                <h3 style="font-size: 18px; margin-bottom: 15px; color: #333;">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e0e0e0;">
                    <span style="font-size: 15px; color: #333;">–¢–µ–∫—É—â–∏–π –ø—Ä–∏–Ω—Ç–µ—Ä:</span>
                    <span style="font-size: 14px; color: #667eea;" id="currentPrinter">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e0e0e0;">
                    <span style="font-size: 15px; color: #333;">–ê–≤—Ç–æ-–ø–µ—á–∞—Ç—å:</span>
                    <span style="font-size: 14px; color: #667eea;" id="autoPrintStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 12px 0;">
                    <span style="font-size: 15px; color: #333;">–ê–≤—Ç–æ-–∑–∞–ø—É—Å–∫:</span>
                    <span style="font-size: 14px; color: #667eea;" id="autoStartStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>
            
            <button class="btn btn-primary btn-full" id="refreshSettingsBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            <div class="bottom-space"></div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const mainPage = document.getElementById('mainPage');
        const processPage = document.getElementById('processPage');
        const waitingPage = document.getElementById('waitingPage');
        const settingsPage = document.getElementById('settingsPage');
        const statusBadge = document.getElementById('statusBadge');
        const statusText = document.getElementById('statusText');
        const ordersCount = document.getElementById('ordersCount');
        const stickersCount = document.getElementById('stickersCount');
        const startBtn = document.getElementById('startBtn');
        const statusBtn = document.getElementById('statusBtn');
        const logsBtn = document.getElementById('logsBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const logContainer = document.getElementById('logContainer');
        const backToMain = document.getElementById('backToMain');
        const processStatus = document.getElementById('processStatus');
        const processSubStatus = document.getElementById('processSubStatus');
        const processBadge = document.getElementById('processBadge');
        const processedOrders = document.getElementById('processedOrders');
        const totalOrders = document.getElementById('totalOrders');
        const processLogContainer = document.getElementById('processLogContainer');
        const processCancelBtn = document.getElementById('processCancelBtn');
        const backToMainFromSettings = document.getElementById('backToMainFromSettings');
        const refreshSettingsBtn = document.getElementById('refreshSettingsBtn');
        const currentPrinter = document.getElementById('currentPrinter');
        const autoPrintStatus = document.getElementById('autoPrintStatus');
        const autoStartStatus = document.getElementById('autoStartStatus');
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentMode = 'test';
        let isRunning = false;
        let waitingForApproval = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        initApp();
        
        function initApp() {
            const user = tg.initDataUnsafe?.user;
            if (user) {
                addLog(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name || 'Unknown'}`);
            }
            checkBotParams();
            requestStatus();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ URL)
        function checkBotParams() {
            const params = new URLSearchParams(window.location.search);
            const botData = params.get('data');
            
            if (botData) {
                try {
                    const data = JSON.parse(decodeURIComponent(botData));
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    if (data.settings_auth) {
                        if (data.settings_auth.approved) {
                            hideWaitingPage();
                            showSettingsPage();
                            loadSettingsData(data.settings_auth.settings);
                            addLog('‚úÖ –î–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Ä–∞–∑—Ä–µ—à—ë–Ω', 'success');
                        } else if (data.settings_auth.denied) {
                            hideWaitingPage();
                            showMainPage();
                            addLog('‚ùå –î–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –∑–∞–ø—Ä–µ—â—ë–Ω', 'error');
                        }
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                    if (data.status) {
                        updateStatus(data.status, data.mode);
                        addLog(`üìä –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω: ${data.status}`, 'info');
                    }
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    if (data.stats) {
                        ordersCount.textContent = data.stats.orders || 0;
                        stickersCount.textContent = data.stats.stickers || 0;
                    }
                    
                    // –õ–æ–≥–∏
                    if (data.logs && Array.isArray(data.logs)) {
                        logContainer.innerHTML = '';
                        data.logs.forEach(log => {
                            addLog(log.message, log.type || 'info');
                        });
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:', e);
                }
            }
        }
        
        // –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
        modeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                modeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMode = btn.dataset.mode;
                startBtn.textContent = currentMode === 'test' ? '‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å (—Ç–µ—Å—Ç)' : '‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å (—Ä–∞–±–æ—á–∏–π)';
                addLog(`üîÑ –†–µ–∂–∏–º –∏–∑–º–µ–Ω—ë–Ω: ${currentMode}`, 'action');
            });
        });
        
        // –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        startBtn.addEventListener('click', () => {
            if (isRunning) return;
            addLog(`üöÄ –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (${currentMode} —Ä–µ–∂–∏–º)`, 'action');
            tg.sendData(JSON.stringify({ action: 'start_process', mode: currentMode }));
            showProcessPage();
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
        statusBtn.addEventListener('click', () => {
            addLog('üìä –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞...', 'action');
            requestStatus();
        });
        
        // –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞
        function requestStatus() {
            tg.sendData(JSON.stringify({ action: 'check_status' }));
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
        logsBtn.addEventListener('click', () => {
            addLog('üìú –ó–∞–ø—Ä–æ—Å –ª–æ–≥–æ–≤...', 'action');
            tg.sendData(JSON.stringify({ action: 'get_logs' }));
        });
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –∑–∞–ø—Ä–æ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        settingsBtn.addEventListener('click', () => {
            if (waitingForApproval) return;
            addLog('‚öôÔ∏è –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º...', 'action');
            
            const user = tg.initDataUnsafe?.user;
            tg.sendData(JSON.stringify({
                action: 'request_settings_access',
                session_id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                user: { id: user?.id, first_name: user?.first_name, username: user?.username }
            }));
            
            waitingForApproval = true;
            showWaitingPage();
        });
        
        // –û—Ç–º–µ–Ω–∞ (–≥–ª–∞–≤–Ω–∞—è)
        cancelBtn.addEventListener('click', () => {
            addLog('üõë –û—Ç–º–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏...', 'warning');
            tg.sendData(JSON.stringify({ action: 'cancel_process' }));
            resetUI();
        });
        
        // –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π
        backToMain.addEventListener('click', () => hideProcessPage());
        backToMainFromSettings.addEventListener('click', () => hideSettingsPage());
        
        // –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        refreshSettingsBtn.addEventListener('click', () => {
            addLog('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫...', 'action');
            tg.sendData(JSON.stringify({ action: 'get_settings' }));
        });
        
        // –û—Ç–º–µ–Ω–∞ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞)
        processCancelBtn.addEventListener('click', () => {
            addProcessLog('üõë –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–º–µ–Ω—É...', 'warning');
            tg.sendData(JSON.stringify({ action: 'cancel_process' }));
            setTimeout(() => { hideProcessPage(); resetUI(); }, 1000);
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(status, mode = null) {
            if (status === 'ready') {
                statusBadge.className = 'status-badge';
                statusBadge.innerHTML = 'üü¢ –ì–æ—Ç–æ–≤';
                statusText.textContent = '–ê–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
                isRunning = false;
                startBtn.disabled = false;
                cancelBtn.disabled = true;
            } else if (status === 'busy') {
                statusBadge.className = 'status-badge';
                statusBadge.innerHTML = '<span class="loading"></span>–ó–∞–Ω—è—Ç';
                statusText.textContent = mode ? `–û–±—Ä–∞–±–æ—Ç–∫–∞ (${mode})` : '–ó–∞–Ω—è—Ç';
                isRunning = true;
                startBtn.disabled = true;
                cancelBtn.disabled = false;
            } else if (status === 'error') {
                statusBadge.className = 'status-badge';
                statusBadge.innerHTML = 'üî¥ –û—à–∏–±–∫–∞';
                statusText.textContent = '–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è';
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞
        function addLog(message, type = 'info') {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            let typeClass = 'log-info';
            if (type === 'success') typeClass = 'log-success';
            if (type === 'error') typeClass = 'log-error';
            if (type === 'warning') typeClass = 'log-warning';
            if (type === 'action') typeClass = 'log-action';
            entry.innerHTML = `<span class="log-time">[${timeStr}]</span><span class="${typeClass}">${message}</span>`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function showMainPage() {
            processPage.classList.remove('active');
            waitingPage.classList.remove('active');
            settingsPage.classList.remove('active');
            mainPage.style.display = 'block';
        }
        function showProcessPage() {
            mainPage.style.display = 'none';
            processPage.classList.add('active');
            isRunning = true;
            startBtn.disabled = true;
            cancelBtn.disabled = false;
        }
        function hideProcessPage() { showMainPage(); }
        function showWaitingPage() {
            mainPage.style.display = 'none';
            waitingPage.classList.add('active');
        }
        function hideWaitingPage() { waitingPage.classList.remove('active'); waitingForApproval = false; }
        function showSettingsPage() {
            mainPage.style.display = 'none';
            settingsPage.classList.add('active');
        }
        function hideSettingsPage() { showMainPage(); }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function loadSettingsData(settings) {
            if (settings.printer) currentPrinter.textContent = settings.printer;
            if (settings.auto_print !== undefined) autoPrintStatus.textContent = settings.auto_print ? '‚úÖ –í–∫–ª—é—á–µ–Ω–∞' : '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–∞';
            if (settings.auto_start !== undefined) autoStartStatus.textContent = settings.auto_start ? '‚úÖ –í–∫–ª—é—á—ë–Ω' : '‚ùå –û—Ç–∫–ª—é—á—ë–Ω';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
        function updateProcessStatus(status) {
            const statuses = {
                'starting': ['üöÄ –ó–∞–ø—É—Å–∫...', '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ'],
                'searching_orders': ['üì¶ –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤...', '–ó–∞–ø—Ä–æ—Å –∫ API Wildberries'],
                'processing': ['üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞...', ''],
                'downloading': ['üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ...', '–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∏–∫–µ—Ä–æ–≤'],
                'sending': ['üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...', '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤'],
                'printing': ['üñ®Ô∏è –ü–µ—á–∞—Ç—å...', '–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä'],
                'completed': ['‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ!', '–í—Å–µ –∑–∞–∫–∞–∑—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã'],
                'cancelled': ['üõë –û—Ç–º–µ–Ω–µ–Ω–æ', '–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞']
            };
            const [title, sub] = statuses[status] || ['–ó–∞–ø—É—Å–∫...', ''];
            processStatus.textContent = title;
            processSubStatus.textContent = sub;
            if (status === 'completed') {
                processBadge.innerHTML = '‚úÖ –ì–æ—Ç–æ–≤–æ';
            } else if (status === 'cancelled') {
                processBadge.innerHTML = 'üõë –û—Ç–º–µ–Ω–µ–Ω–æ';
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞)
        function addProcessLog(message, type = 'info') {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            let typeClass = 'log-info';
            if (type === 'success') typeClass = 'log-success';
            if (type === 'error') typeClass = 'log-error';
            if (type === 'warning') typeClass = 'log-warning';
            if (type === 'action') typeClass = 'log-action';
            entry.innerHTML = `<span class="log-time">[${timeStr}]</span><span class="${typeClass}">${message}</span>`;
            processLogContainer.appendChild(entry);
            processLogContainer.scrollTop = processLogContainer.scrollHeight;
            addLog(message, type);
        }
        
        // –°–±—Ä–æ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function resetUI() {
            isRunning = false;
            startBtn.disabled = false;
            cancelBtn.disabled = true;
            updateStatus('ready');
        }
        
        addLog('‚úÖ –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
    </script>
</body>
</html>